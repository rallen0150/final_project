{% extends 'base.html' %}
{% load staticfiles %}

{% block css %}
  <style media="screen">
    .star.icon {
      color: #DAA520;
    }
  </style>
{% endblock %}

{% block content %}
<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

  <h1>Find your Food Truck</h1>

  <div class="ui grid" >
      <div class="eight wide column">
        <div class="ui accordion">
          {% for truck in truck_list %}
          <div class="title">
            <i class="dropdown icon"></i>
            <b>{{ truck }}</b>
            {% if truck.avg_rating == 1 %}
            <div class="ui star rating star_rating_system">
              <i class="star icon"></i>
              <i class="empty star icon"></i>
              <i class="empty star icon"></i>
              <i class="empty star icon"></i>
              <i class="empty star icon"></i>
            {% endif %}
            {% if truck.avg_rating == 2 %}
                <i class="star icon"></i>
                <i class="star icon"></i>
                <i class="empty star icon"></i>
                <i class="empty star icon"></i>
                <i class="empty star icon"></i>
            {% endif %}
            {% if truck.avg_rating == 3 %}
                <i class="star icon"></i>
                <i class="star icon"></i>
                <i class="star icon"></i>
                <i class="empty star icon"></i>
                <i class="empty star icon"></i>
            {% endif %}
            {% if truck.avg_rating == 4 %}
                <i class="star icon"></i>
                <i class="star icon"></i>
                <i class="star icon"></i>
                <i class="star icon"></i>
                <i class="empty star icon"></i>
            {% endif %}
            {% if truck.avg_rating == 5 %}
                <i class="star icon"></i>
                <i class="star icon"></i>
                <i class="star icon"></i>
                <i class="star icon"></i>
                <i class="star icon"></i>
              </div>
            {% endif %}
          </div>
          <div id="list">
            <p>
              <a href="{% url 'foodtruck_detail_view' truck.id %}">{{ truck }}</a><br>
              <b>Address: {{ truck.address }}</b>
              {% if request.user == truck.driver %}
                <a href="{% url 'location_update_view' truck.id %}"> Move Location</a>
              {% endif %} <br>
              Type: {{ truck.category.food_type }}<br>

              {% if request.user == truck.driver %}
                {% if not truck.checked_in %}
                  <a href="{% url 'checkin_update_view' truck.id %}">Check In</a>
                {% else %}
                  <a href="{% url 'checkin_update_view' truck.id %}">Check Out</a>
                {% endif %}
              {% endif %}
            </p>
          </div>
          {% endfor %}
        </div>
    </div>
    <div class="eight wide column">
      Find Which Trucks Are Around You! <br>
      Address: <input type="text" name="" id="address">
      <input type="button" value="Find Lat/Lng" onclick="CodeAddress()">

      <script type="text/javascript">
        function CodeAddress() {
          var geocoder = new google.maps.Geocoder();
          // var map = new google.maps.Map(document.getElementById('map'), {
          //   zoom: 13,
          //   center: {lat: 34.8574, lng: -82.390189},
          // });
          var address = document.getElementById('address').value;

          geocoder.geocode({'address': address}, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
              var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 15,
                center: results[0].geometry.location,
              });
              // map.setCenter(results[0].geometry.location);
              $.getJSON("/api/foodtrucks/", function(result) {

                var icon = {
                  Mexican: {url: 'http://cdn.mysitemyway.com/icons-watermarks/simple-red/iconathon/iconathon_food-truck/iconathon_food-truck_simple-red_512x512.png',
                            size: new google.maps.Size(40, 40),
                            origin: new google.maps.Point(0, 0),
                            anchor: new google.maps.Point(17, 34),
                            scaledSize: new google.maps.Size(30, 35)},
                  Greek: {url: 'http://st.depositphotos.com/1005920/4316/i/110/depositphotos_43162503-Truck-icon.jpg',
                            size: new google.maps.Size(50, 50),
                            origin: new google.maps.Point(0, 0),
                            anchor: new google.maps.Point(17, 34),
                            scaledSize: new google.maps.Size(40, 45)},
                  IceCream: {url: 'https://d30y9cdsu7xlg0.cloudfront.net/png/56083-200.png',
                              size: new google.maps.Size(40, 40),
                              origin: new google.maps.Point(0, 0),
                              anchor: new google.maps.Point(17, 34),
                              scaledSize: new google.maps.Size(30, 35)},
                }

                  for (var i = 0; i < result.length; i++) {
                    // console.log(i);
                    var obj = result[i];
                    var x = obj.find_lat_lng;
                    console.log(x);
                    if (obj.category == 1) {
                      if (obj.checked_in == true) {
                        var marker = new google.maps.Marker({
                          position: x,
                          icon: icon['Mexican'],
                          map: map,
                          content: '<div class="scrollFix">' + '<b>' + obj.truck_name + '</b>' + "<br><hr>Latitude: " + obj.latitude + "<br/>Longitude: " + obj.longitude + '</div>'
                        });

                        // Starting the infowindow popup
                        var infowindow = new google.maps.InfoWindow();
                        // Adds the click part of the infowindow on the marker
                        google.maps.event.addListener(marker, 'click', (function(marker, i, infowindow) {
                          return function() {
                            infowindow.setContent(this.content);
                            infowindow.open(map, this);
                          };
                        })(marker, i, infowindow));
                        // bounds.extend(marker.position);
                        // Has the infowindows pop out instantly
                        // google.maps.event.trigger(marker, 'click');
                      }
                    }
                    if (obj.category == 2) {
                      if (obj.checked_in == true) {
                        var marker = new google.maps.Marker({
                          position: x,
                          icon: icon['Greek'],
                          map: map,
                          content: '<div class="scrollFix">' + '<b>' + obj.truck_name + '</b>' + "<br><hr>Latitude: " + obj.latitude + "<br/>Longitude: " + obj.longitude + '</div>'
                        });

                        // Starting the infowindow popup
                        var infowindow = new google.maps.InfoWindow();
                        // Adds the click part of the infowindow on the marker
                        google.maps.event.addListener(marker, 'click', (function(marker, i, infowindow) {
                          return function() {
                            infowindow.setContent(this.content);
                            infowindow.open(map, this);
                          };
                        })(marker, i, infowindow));
                        // bounds.extend(marker.position);
                        // Has the infowindows pop out instantly
                        // google.maps.event.trigger(marker, 'click');
                      }
                    }
                    if (obj.category == 3) {
                      if (obj.checked_in == true) {
                        var marker = new google.maps.Marker({
                          position: x,
                          icon: icon['IceCream'],
                          map: map,
                          content: '<div class="scrollFix">' + '<b>' + obj.truck_name + '</b>' + "<br><hr>Latitude: " + obj.latitude + "<br/>Longitude: " + obj.longitude + '</div>'
                        });

                        // Starting the infowindow popup
                        var infowindow = new google.maps.InfoWindow();
                        // Adds the click part of the infowindow on the marker
                        google.maps.event.addListener(marker, 'click', (function(marker, i, infowindow) {
                          return function() {
                            infowindow.setContent(this.content);
                            infowindow.open(map, this);
                          };
                        })(marker, i, infowindow));
                        // bounds.extend(marker.position);
                        // Has the infowindows pop out instantly
                        // google.maps.event.trigger(marker, 'click');
                      }
                    }
                  }
              });
              var marker = new google.maps.Marker({
                  map: map,
                  position: results[0].geometry.location
              });
              // alert("Lat/Lng: " + results[0].geometry.location);
            } else {
              alert('Geocode was not successful for the following reason: ' + status);
            }
          });
        }
      </script>
      <br><br>


      <div id="map"></div>

          <script type="text/javascript">

          function initMap() {
            var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 15,
              center: {lat: 34.8574, lng: -82.390189},
             });

             var geocoder = new google.maps.Geocoder();
             // var map = new google.maps.Map(document.getElementById('map'), {
             //   zoom: 13,
             //   center: {lat: 34.8574, lng: -82.390189},
             // });
             var address = document.getElementById('address').value;




                var latlng = $.getJSON("/api/foodtrucks/", function(result) {

                  // console.log(result)

                  // Create a custom marker
                  var icon = {
                    Mexican: {url: 'http://cdn.mysitemyway.com/icons-watermarks/simple-red/iconathon/iconathon_food-truck/iconathon_food-truck_simple-red_512x512.png',
                              size: new google.maps.Size(40, 40),
                              origin: new google.maps.Point(0, 0),
                              anchor: new google.maps.Point(17, 34),
                              scaledSize: new google.maps.Size(30, 35)},
                    Greek: {url: 'http://st.depositphotos.com/1005920/4316/i/110/depositphotos_43162503-Truck-icon.jpg',
                              size: new google.maps.Size(50, 50),
                              origin: new google.maps.Point(0, 0),
                              anchor: new google.maps.Point(17, 34),
                              scaledSize: new google.maps.Size(40, 45)},
                    IceCream: {url: 'https://d30y9cdsu7xlg0.cloudfront.net/png/56083-200.png',
                                size: new google.maps.Size(40, 40),
                                origin: new google.maps.Point(0, 0),
                                anchor: new google.maps.Point(17, 34),
                                scaledSize: new google.maps.Size(30, 35)},
                  }
                  for (var i = 0; i < result.length; i++) {
                    // console.log(i);
                    var obj = result[i];
                    console.log(obj.address);
                    var x = obj.find_lat_lng;
                    console.log(x);
                    if (obj.category == 1) {
                      if (obj.checked_in == true) {
                        var marker = new google.maps.Marker({
                          position: x,
                          icon: icon['Mexican'],
                          map: map,
                          content: '<div class="scrollFix">' + '<b>' + obj.truck_name + '</b>' + "<br><hr>Address: " + obj.address + '</div>'
                        });

                        // Starting the infowindow popup
                        var infowindow = new google.maps.InfoWindow();
                        // Adds the click part of the infowindow on the marker
                        google.maps.event.addListener(marker, 'click', (function(marker, i, infowindow) {
                          return function() {
                            infowindow.setContent(this.content);
                            infowindow.open(map, this);
                          };
                        })(marker, i, infowindow));
                        // bounds.extend(marker.position);
                        // Has the infowindows pop out instantly
                        // google.maps.event.trigger(marker, 'click');
                      }
                    }
                    if (obj.category == 2) {
                      if (obj.checked_in == true) {
                        var marker = new google.maps.Marker({
                          position: x,
                          icon: icon['Greek'],
                          map: map,
                          content: '<div class="scrollFix">' + '<b>' + obj.truck_name + '</b>' + "<br><hr>Address: " + obj.address + '</div>'
                        });

                        // Starting the infowindow popup
                        var infowindow = new google.maps.InfoWindow();
                        // Adds the click part of the infowindow on the marker
                        google.maps.event.addListener(marker, 'click', (function(marker, i, infowindow) {
                          return function() {
                            infowindow.setContent(this.content);
                            infowindow.open(map, this);
                          };
                        })(marker, i, infowindow));
                        // bounds.extend(marker.position);
                        // Has the infowindows pop out instantly
                        // google.maps.event.trigger(marker, 'click');
                      }
                    }
                    if (obj.category == 3) {
                      if (obj.checked_in == true) {
                        var marker = new google.maps.Marker({
                          position: x,
                          icon: icon['IceCream'],
                          map: map,
                          content: '<div class="scrollFix">' + '<b>' + obj.truck_name + '</b>' + "<br><hr>Address: " + obj.address + '</div>'
                        });

                        // Starting the infowindow popup
                        var infowindow = new google.maps.InfoWindow();
                        // Adds the click part of the infowindow on the marker
                        google.maps.event.addListener(marker, 'click', (function(marker, i, infowindow) {
                          return function() {
                            infowindow.setContent(this.content);
                            infowindow.open(map, this);
                          };
                        })(marker, i, infowindow));
                        // bounds.extend(marker.position);
                        // Has the infowindows pop out instantly
                        // google.maps.event.trigger(marker, 'click');
                      }
                    }

                  }
                });
              }
          </script>
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCJ2GhgOOCaoypV0JCC4NnxS-M0enWpN64&callback=initMap">
        </script>


    </div>
</div>



{% endblock %}

{% block js %}
  <script src="https://code.jquery.com/ui/1.10.0/jquery-ui.js"></script>

<script type="text/javascript">
$(function() {
  $('.ui.accordion').accordion({
    active: false,
    collapsible: true
  });
})
</script>

{% endblock %}

<!-- NOT IN THE PROGRAM, BUT JUST IN CASE I NEED IT -->

Find Your Address Based off Lat/Long <br>
Latitude:
  <input type="text" id="Latitude" />
  Latitude:
  <input type="text" id="Longitude"/>
  <input type="button" value="Find Address" onclick="GetAddress()" />
  <!-- {% comment %}
  <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
  {% endcomment %} -->
  <script type="text/javascript">
  // This is my reverse geocode function
      function GetAddress() {
          var latitude = parseFloat(document.getElementById("Latitude").value);
          var longitude = parseFloat(document.getElementById("Longitude").value);
          var latlng = new google.maps.LatLng(latitude, longitude);
          var geocoder = new google.maps.Geocoder();
          geocoder.geocode({ 'latLng': latlng }, function (results, status) {
              if (status == google.maps.GeocoderStatus.OK) {
                  if (results[0]) {
                      alert("Location: " + results[0].formatted_address);
                  }
              }
          });
      }
</script> <br>
